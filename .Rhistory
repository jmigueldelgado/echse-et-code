################################################################################
# Author: Julius Eberhard
# Last Edit: 2017-03-31
# Project: ECHSE Evapotranspiration
# Program: echse_portugal
# Aim: Data Preprocessing and Main Executing Script for ET in Portugal
################################################################################
rm(list=ls())
assign("last.warning", NULL, envir=baseenv())
# set time zone to UTC
Sys.setenv(TZ="UTC")
# PROGRAM PARAMETERS -----------------------------------------------------------
output <- "evap"  # [evap, glorad, gloradmax, rad_net, radex, soilheat]
field.station <- "HS"  # [HS, NSA]
et.choice <- "eta"  # potential or actual evapotranspiration [etp, eta]
et.choice[2] <- 13  # model [1=Makk, 11=PM, 12=FAO, 13=SW]
wc.new <- T  # logical: Shall the newly calculated soil moisture data be used?
# model period: start & end of model period, note the format!
if (output %in% c("gloradmax", "rad_net", "radex")) {
tstart <- "2014-04-29 22:00:00"
tend <- "2014-07-01 05:00:00"
} else if (field.station == "HS") {
# HS
#tstart <- "2014-04-29 21:00:00"; tend <- "2014-05-04 13:00:00"
#####tstart <- "2014-05-08 23:00:00"; tend <- "2014-05-10 01:00:00"
#tstart <- "2014-05-13 23:00:00"; tend <- "2014-05-20 19:00:00"
#tstart <- "2014-05-22 13:00:00"; tend <- "2014-05-25 21:00:00"
#tstart <- "2014-06-16 23:00:00"; tend <- "2014-06-21 17:00:00"
tstart <- "2014-06-26 18:00:00"; tend <- "2014-07-01 05:00:00"
} else {
# NSA
#tstart <- "2014-04-29 22:00:00"; tend <- "2014-05-04 13:00:00"
tstart <- "2014-05-13 23:00:00"; tend <- "2014-05-20 19:00:00"
#tstart <- "2014-05-22 13:00:00"; tend <- "2014-05-25 21:00:00"
#tstart <- "2014-06-11 23:00:00"; tend <- "2014-06-14 03:00:00"
#tstart <- "2014-06-16 23:00:00"; tend <- "2014-06-21 17:00:00"
#tstart <- "2014-06-25 23:00:00"; tend <- "2014-07-01 07:00:00"
#tstart <- "2014-07-14 23:00:00"; tend <- "2014-07-21 07:00:00"
#tstart <- "2014-07-23 23:00:00"; tend <- "2014-08-04 18:00:00"
}
# Shall the model period strictly exclude times with missing data?
no.na <- T
# For rad_net & radex, we need a maximum of the data, so no.na is unchecked.
if (output %in% c("gloradmax", "rad_net", "radex"))
no.na <- F
# declare availability of input data
A <- list(alb=1,
apress=1,
cano_height=1,
cloud=0,
doy=1,
glorad=1,
glorad_max=0,
hour=1,
lai=1,
rad_long=0,
rad_net=1,
rad_net_soil=0,
radex=0,
rhum=1,
soilheat=1,
sundur=0,
temp_max=0,
temp_min=0,
temper=1,
totalheat=0,
utc_add=1,
wc_vol_root=1,
wc_vol_top=1,
wind=1)
# locations
locs <- list(field.station,  # alb
"Met",  # apress
field.station,  # cano_height
"any",  # cloud, not actually used
"any",  # doy
"Met",  # glorad
"any",  # glorad_max
"any",  # hour
field.station,  # lai
"any",  # rad_long
field.station,  # rad_net
"any",  # rad_net_soil
"any",  # radex
"Met",  # rhum
field.station,  # soilheat
"Met",  # sundur
"any",  # temp_max
"any",  # temp_min
field.station,  # temper
"any",  # totalheat
"any",  # utc_add
field.station,  # wc_vol_root
field.station,  # wc_vol_top
field.station)  # wind
# SET AND LOAD -----------------------------------------------------------------
# set working directory
if (system("hostname", intern=T) == "raspberrypi") {
setwd("/home/pi/ownCloud/whk_echse")
} else {
setwd("/home/julius/boxup/whk_echse")
}
# load scripts
source("~/R/jufun.R")  # CheckPack()
source("echseCtrl.R")  # control files
source("echseInput.R")  # data input files
source("echseParEst.R")  # parameter estimation
source("echsePost.R")  # postprocessing
source("echsePre.R")  # preprocessing
# load packages
CheckPack(c("MASS", "RAtmosphere", "soilwaterptf", "TTR", "xtable", "xts"))
library(MASS)  # write.matrix()
library(soilwaterptf)
library(xtable)  # latex tables
library(xts)  # time series handling
# load data
load("data/portugal/meteo_HS.Rdata")
